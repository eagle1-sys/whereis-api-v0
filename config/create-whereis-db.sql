-- create shcema if it doesn't exist
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT FROM pg_catalog.pg_namespace
        WHERE nspname = 'whereis_schema'
    ) THEN
CREATE SCHEMA whereis_schema;
END IF;
END $$;

-- set the default schema search path
ALTER DATABASE whereis SET search_path TO whereis_schema;

-- create entities table if it doesn't exist
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT FROM pg_tables
        WHERE schemaname = 'whereis_schema'
        AND tablename = 'entities'
    ) THEN
CREATE TABLE whereis_schema.entities
(
    uuid          varchar(64) not null primary key,
    id            varchar(64) not null,
    type          varchar(64),
    extra         jsonb,
    completed     boolean,
    params        jsonb,
    creation_time varchar(32)
);
-- create index on table
CREATE INDEX entities_idx_id ON whereis_schema.entities (id);
END IF;
END $$;

-- create events table if it doesn't exist
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT FROM pg_tables
        WHERE schemaname = 'whereis_schema'
        AND tablename = 'events'
    ) THEN
CREATE TABLE whereis_schema.events
(
    event_id          varchar(64) not null primary key,
    status            integer,
    what_             varchar(128),
    whom_             varchar(128),
    when_             varchar(64),
    where_            varchar(128),
    notes             varchar(512),
    operator_code     varchar(32),
    tracking_num      varchar(64),
    data_provider     varchar(64),
    exception_code    integer,
    exception_desc    varchar(128),
    notification_code integer,
    notification_desc varchar(128),
    extra             jsonb,
    source_data       jsonb
);
-- create indexes on events table
CREATE INDEX events_idx_operator_code ON whereis_schema.events (operator_code);
CREATE INDEX events_idx_tracking_num ON whereis_schema.events (tracking_num);
END IF;
END $$;

-- create tokens table if it doesn't exist
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT FROM pg_tables
        WHERE schemaname = 'whereis_schema'
        AND tablename = 'tokens'
    ) THEN
CREATE TABLE whereis_schema.tokens
(
    id varchar(67) NOT NULL PRIMARY KEY,
    user_id varchar(64)
);
END IF;
END $$;

-- create whereis_user role if it doesn't exist
DO $$
BEGIN
    IF NOT EXISTS (SELECT FROM pg_roles WHERE rolname = 'whereis_user') THEN
        CREATE USER whereis_user WITH PASSWORD '_CHANGEME_';
END IF;
END $$;

-- grant privileges to whereis_user
GRANT USAGE ON SCHEMA whereis_schema TO whereis_user;
GRANT SELECT, INSERT, UPDATE , DELETE ON ALL TABLES IN SCHEMA whereis_schema TO whereis_user;

-- insert test data - access token
INSERT INTO whereis_schema.tokens(id, user_id) VALUES ('eagle1', 'test_user');

-- inset test data - fdx waybill
INSERT INTO whereis_schema.entities (uuid, id, type, extra, completed, params, creation_time) VALUES ('eg1_d54ab9d1-4721-4262-bfaa-c1bb0ae6543d', 'eg1-012301230123', 'waybill', '{"origin": "PACHECO CA, United States", "destination": "London, United Kingdom"}', true, '{}', '2025-07-16T13:58:34-05:00');

insert into whereis_schema.events (event_id, status, what_, whom_, when_, where_, notes, operator_code, tracking_num, data_provider, exception_code, exception_desc, notification_code, notification_desc, extra, source_data)
values  ('ev_eg1-012301230123-1752692314-3000', 3000, 'Transport Bill Created', 'Eagle1', '2025-07-16T13:58:34-05:00', 'Customer location', 'Shipment information sent to Eagle1', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.657Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-16T13:58:34-05:00", "eventType": "OC", "locationType": "CUSTOMER", "scanLocation": {"residential": false, "streetLines": [""]}, "derivedStatus": "Label created", "exceptionCode": "", "eventDescription": "Shipment information sent to Eagle1", "derivedStatusCode": "IN", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752696540-3050', 3050, 'Picked Up', 'Eagle1', '2025-07-16T13:09:00-07:00', 'PACHECO CA United States', '', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-16T13:09:00-07:00", "eventType": "PU", "locationId": "CCRA", "locationType": "PICKUP_LOCATION", "scanLocation": {"city": "PACHECO", "postalCode": "94553", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "Picked up", "exceptionCode": "", "eventDescription": "Picked up", "derivedStatusCode": "PU", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752696660-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-07-16T13:11:00-07:00', 'PACHECO CA United States', 'Shipment arriving early', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-16T13:11:00-07:00", "eventType": "AE", "locationId": "CCRA", "locationType": "PICKUP_LOCATION", "scanLocation": {"city": "PACHECO", "postalCode": "94553", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Shipment arriving early", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752711300-3100', 3100, 'Received by Carrier', 'Eagle1', '2025-07-16T17:15:00-07:00', 'PACHECO CA United States', 'Left Eagle1 origin facility', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-16T17:15:00-07:00", "eventType": "DP", "locationId": "CCRA", "locationType": "ORIGIN_FEDEX_FACILITY", "scanLocation": {"city": "PACHECO", "postalCode": "94553", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Left Eagle1 origin facility", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752715140-3002', 3002, 'Arrived, In-Transit', 'Eagle1', '2025-07-16T18:19:00-07:00', 'OAKLAND CA United States', 'Arrived at Eagle1 hub', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-16T18:19:00-07:00", "eventType": "AR", "locationId": "OAKH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "OAKLAND", "postalCode": "94621", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Arrived at Eagle1 hub", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752717300-3250', 3250, 'In-Transit', 'Eagle1', '2025-07-16T18:55:00-07:00', 'OAKLAND CA United States', 'Departed Eagle1 hub', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-16T18:55:00-07:00", "eventType": "DP", "locationId": "OAKH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "OAKLAND", "postalCode": "94621", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Departed Eagle1 hub", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752742500-3002', 3002, 'Arrived, In-Transit', 'Eagle1', '2025-07-17T01:55:00-07:00', 'OAKLAND CA United States', 'Arrived at Eagle1 hub', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-17T01:55:00-07:00", "eventType": "AR", "locationId": "OAKH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "OAKLAND", "postalCode": "94621", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Arrived at Eagle1 hub", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752761820-3250', 3250, 'In-Transit', 'Eagle1', '2025-07-17T07:17:00-07:00', 'OAKLAND CA United States', 'Departed Eagle1 hub', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-17T07:17:00-07:00", "eventType": "DP", "locationId": "OAKH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "OAKLAND", "postalCode": "94621", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Departed Eagle1 hub", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752774900-3002', 3002, 'Arrived, In-Transit', 'Eagle1', '2025-07-17T13:55:00-04:00', 'INDIANAPOLIS IN United States', 'Arrived at Eagle1 hub', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-17T13:55:00-04:00", "eventType": "AR", "locationId": "INDH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "INDIANAPOLIS", "postalCode": "46241", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "IN"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Arrived at Eagle1 hub", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752783900-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-07-17T16:25:00-04:00', 'INDIANAPOLIS IN United States', 'On the way', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-17T16:25:00-04:00", "eventType": "IT", "locationId": "INDH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "INDIANAPOLIS", "postalCode": "46241", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "IN"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "On the way", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752784080-3250', 3250, 'In-Transit', 'Eagle1', '2025-07-17T16:28:00-04:00', 'INDIANAPOLIS IN United States', 'Departed Eagle1 hub', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-17T16:28:00-04:00", "eventType": "DP", "locationId": "INDH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "INDIANAPOLIS", "postalCode": "46241", "countryCode": "US", "countryName": "United States", "residential": false, "streetLines": [""], "stateOrProvinceCode": "IN"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Departed Eagle1 hub", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752810900-3002', 3002, 'Arrived, In-Transit', 'Eagle1', '2025-07-18T05:55:00+02:00', 'GRACE-HOLLOGNE  Belgium', 'Arrived at Eagle1 hub', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-18T05:55:00+02:00", "eventType": "AR", "locationId": "LGGH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "GRACE-HOLLOGNE", "postalCode": "4460", "countryCode": "BE", "countryName": "Belgium", "residential": false, "streetLines": [""]}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Arrived at Eagle1 hub", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752828120-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-07-18T10:42:00+02:00', 'GRACE-HOLLOGNE  Belgium', 'On the way', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-18T10:42:00+02:00", "eventType": "IT", "locationId": "LGGH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "GRACE-HOLLOGNE", "postalCode": "4460", "countryCode": "BE", "countryName": "Belgium", "residential": false, "streetLines": [""]}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "On the way", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1752898200-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-07-19T06:10:00+02:00', 'GRACE-HOLLOGNE  Belgium', 'On the way', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-19T06:10:00+02:00", "eventType": "IT", "locationId": "LGGH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "GRACE-HOLLOGNE", "postalCode": "4460", "countryCode": "BE", "countryName": "Belgium", "residential": false, "streetLines": [""]}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "On the way", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753113180-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-07-21T16:53:00+01:00', 'LONDON United Kingdom', 'On the way', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-21T16:53:00+01:00", "eventType": "IT", "locationId": "QQKH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "DARTFORD", "postalCode": "DA1", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "KE"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "On the way", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753113300-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-07-21T16:55:00+01:00', 'LONDON United Kingdom', 'At local Eagle1 facility', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-21T16:55:00+01:00", "eventType": "AF", "locationId": "QQKH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "DARTFORD", "postalCode": "DA1", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "KE"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "At local Eagle1 facility", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753172220-3400', 3400, 'Customs Clearance: Import Released', 'Eagle1', '2025-07-22T09:17:00+01:00', 'LONDON United Kingdom', 'International shipment release - Import', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-22T09:17:00+01:00", "eventType": "CC", "locationId": "QQKIP", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "DARTFORD", "postalCode": "DA1", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "KE"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "International shipment release - Import", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753172280-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-07-22T09:18:00+01:00', 'LONDON United Kingdom', 'Delivery updated: Delivery updated', 'eg1', '012301230123', 'Eagle1', 900, 'Exception Occurred', null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-22T09:18:00+01:00", "eventType": "DY", "locationId": "QQKIP", "delayDetail": {"type": "GENERAL"}, "locationType": "DESTINATION_FEDEX_FACILITY", "scanLocation": {"city": "DARTFORD", "postalCode": "DA1", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "KE"}, "derivedStatus": "Delivery updated", "exceptionCode": "A52", "eventDescription": "Delivery updated", "derivedStatusCode": "DU", "exceptionDescription": "Delivery updated"}'),
        ('ev_eg1-012301230123-1753175820-3400', 3400, 'Customs Clearance: Import Released', 'Eagle1', '2025-07-22T10:17:00+01:00', 'LONDON United Kingdom', 'International shipment release - Import', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-22T10:17:00+01:00", "eventType": "CC", "locationId": "QQKIP", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "DARTFORD", "postalCode": "DA1", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "KE"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "International shipment release - Import", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753222080-3250', 3250, 'In-Transit', 'Eagle1', '2025-07-22T23:08:00+01:00', 'LONDON United Kingdom', 'Departed Eagle1 hub', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-22T23:08:00+01:00", "eventType": "DP", "locationId": "QQKH", "locationType": "FEDEX_FACILITY", "scanLocation": {"city": "DARTFORD", "postalCode": "DA1", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "KE"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "Departed Eagle1 hub", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753233240-3300', 3300, 'Arrived At Destination', 'Eagle1', '2025-07-23T02:14:00+01:00', 'LONDON United Kingdom', 'At local Eagle1 facility', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-23T02:14:00+01:00", "eventType": "AR", "locationId": "CSAA", "locationType": "DESTINATION_FEDEX_FACILITY", "scanLocation": {"city": "HUNTINGDON", "postalCode": "PE29", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "At local Eagle1 facility", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753233300-3300', 3300, 'Arrived At Destination', 'Eagle1', '2025-07-23T02:15:00+01:00', 'LONDON United Kingdom', 'At local Eagle1 facility', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-23T02:15:00+01:00", "eventType": "AR", "locationId": "CSAA", "locationType": "DESTINATION_FEDEX_FACILITY", "scanLocation": {"city": "HUNTINGDON", "postalCode": "PE29", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "At local Eagle1 facility", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753233360-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-07-23T02:16:00+01:00', 'LONDON United Kingdom', 'Delivery updated: Delivery updated', 'eg1', '012301230123', 'Eagle1', 900, 'Exception Occurred', null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-23T02:16:00+01:00", "eventType": "DY", "locationId": "CSAA", "delayDetail": {"type": "GENERAL"}, "locationType": "DESTINATION_FEDEX_FACILITY", "scanLocation": {"city": "HUNTINGDON", "postalCode": "PE29", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "Delivery updated", "exceptionCode": "A52", "eventDescription": "Delivery updated", "derivedStatusCode": "DU", "exceptionDescription": "Delivery updated"}'),
        ('ev_eg1-012301230123-1753251420-3450', 3450, 'Final Delivery In-Progress', 'Eagle1', '2025-07-23T07:17:00+01:00', 'LONDON United Kingdom', 'On Eagle1 vehicle for delivery', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-23T08:28:03.659Z", "updateMethod": "manual-pull"}', '{"date": "2025-07-23T07:17:00+01:00", "eventType": "OD", "locationId": "CSAA", "locationType": "VEHICLE", "scanLocation": {"city": "LONDON", "postalCode": "AB12", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "In transit", "exceptionCode": "", "eventDescription": "On Eagle1 vehicle for delivery", "derivedStatusCode": "IT", "exceptionDescription": ""}'),
        ('ev_eg1-012301230123-1753271940-3500', 3500, 'Delivered', 'Eagle1', '2025-07-23T12:59:00+01:00', 'United Kingdom', '', 'eg1', '012301230123', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-24T07:47:27.744Z", "updateMethod": "auto-pull"}', '{"date": "2025-07-23T12:59:00+01:00", "eventType": "DL", "locationId": "CSAA", "locationType": "DELIVERY_LOCATION", "scanLocation": {"city": "LONDON", "postalCode": "ABC123", "countryCode": "GB", "countryName": "United Kingdom", "residential": false, "streetLines": [""], "stateOrProvinceCode": "CA"}, "derivedStatus": "Delivered", "exceptionCode": "", "eventDescription": "Delivered", "derivedStatusCode": "DL", "exceptionDescription": ""}');

-- insert test data - sfex waybill
INSERT INTO whereis_schema.entities (uuid, id, type, extra, completed, params, creation_time) VALUES ('eg1_eb2c6528-cf30-430a-b822-6200b86ed334', 'eg1-123412341234', 'waybill', '{}', true, '{"phonenum": "0123"}', '2025-05-16T01:15:16+08:00');

insert into whereis_schema.events (event_id, status, what_, whom_, when_, where_, notes, operator_code, tracking_num, data_provider, exception_code, exception_desc, notification_code, notification_desc, extra, source_data)
values  ('ev_eg1-123412341234-1747329316-3100', 3100, 'Received by Carrier', 'Eagle1', '2025-05-16T01:15:16+08:00', '三藩市', '顺丰速运 已收取快件，您的期待，我们定竭诚守护，不负所托。', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.419Z", "updateMethod": "manual-pull"}', '{"opCode": "54", "remark": "顺丰速运 已收取快件，您的期待，我们定竭诚守护，不负所托。", "acceptTime": "2025-05-16 01:15:16", "acceptAddress": "三藩市", "firstStatusCode": "1", "firstStatusName": "已揽收", "secondaryStatusCode": "101", "secondaryStatusName": "已揽收"}'),
        ('ev_eg1-123412341234-1747352417-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-05-16T07:40:17+08:00', '三藩市', '快件在【美国三藩市营运中心】完成分拣，准备发往下一站', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "30", "remark": "快件在【美国三藩市营运中心】完成分拣，准备发往下一站", "acceptTime": "2025-05-16 07:40:17", "acceptAddress": "三藩市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747385100-3250', 3250, 'In-Transit', 'Eagle1', '2025-05-16T16:45:00+08:00', '三藩市', '快件在【旧金山国际机场飞往广州白云国际机场航班上，经停东京羽田国际机场】已起飞', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "105", "remark": "快件在【旧金山国际机场飞往广州白云国际机场航班上，经停东京羽田国际机场】已起飞", "acceptTime": "2025-05-16 16:45:00", "acceptAddress": "三藩市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747421156-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-05-17T02:45:56+08:00', '三藩市', '快件在【美国三藩市营运中心】完成分拣，准备发往下一站', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "30", "remark": "快件在【美国三藩市营运中心】完成分拣，准备发往下一站", "acceptTime": "2025-05-17 02:45:56", "acceptAddress": "三藩市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747470132-3350', 3350, 'Customs Clearance: Import In-Progress', 'Eagle1', '2025-05-17T16:22:12+08:00', '广州市', '清关进行中,请耐心等候', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "605", "remark": "清关进行中,请耐心等候", "acceptTime": "2025-05-17 16:22:12", "acceptAddress": "广州市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "204", "secondaryStatusName": "清关中"}'),
        ('ev_eg1-123412341234-1747533377-3002', 3002, 'Arrived, In-Transit', 'Eagle1', '2025-05-18T09:56:17+08:00', '广州市', '快件到达 【广州机场关务组】', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "31", "remark": "快件到达 【广州机场关务组】", "acceptTime": "2025-05-18 09:56:17", "acceptAddress": "广州市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747533438-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-05-18T09:57:18+08:00', '广州市', '快件在【广州机场关务组】完成分拣，准备发往 【广州转运枢纽】', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "30", "remark": "快件在【广州机场关务组】完成分拣，准备发往 【广州转运枢纽】", "acceptTime": "2025-05-18 09:57:18", "acceptAddress": "广州市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747537756-3400', 3400, 'Customs Clearance: Import Released', 'Eagle1', '2025-05-18T11:09:16+08:00', '广州市', 'Supplement event generated by Eagle1', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "system-generated"}', '{}'),
        ('ev_eg1-123412341234-1747537757-3004', 3004, 'Departed, In-Transit', 'Eagle1', '2025-05-18T11:09:17+08:00', '广州市', '快件离开 【广州机场关务组】，已在发往  【广州转运枢纽】 的路上', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "36", "remark": "快件离开 【广州机场关务组】，已在发往  【广州转运枢纽】 的路上", "acceptTime": "2025-05-18 11:09:17", "acceptAddress": "广州市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747540383-3002', 3002, 'Arrived, In-Transit', 'Eagle1', '2025-05-18T11:53:03+08:00', '广州市', '快件到达 【广州转运枢纽】', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "31", "remark": "快件到达 【广州转运枢纽】", "acceptTime": "2025-05-18 11:53:03", "acceptAddress": "广州市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747544780-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-05-18T13:06:20+08:00', '广州市', '快件在【广州转运枢纽】完成分拣，准备发往 【深圳黄田转运中心】', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "30", "remark": "快件在【广州转运枢纽】完成分拣，准备发往 【深圳黄田转运中心】", "acceptTime": "2025-05-18 13:06:20", "acceptAddress": "广州市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747547107-3004', 3004, 'Departed, In-Transit', 'Eagle1', '2025-05-18T13:45:07+08:00', '广州市', '快件离开 【广州转运枢纽】，已在发往  【深圳黄田转运中心】 的路上', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "36", "remark": "快件离开 【广州转运枢纽】，已在发往  【深圳黄田转运中心】 的路上", "acceptTime": "2025-05-18 13:45:07", "acceptAddress": "广州市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747566690-3002', 3002, 'Arrived, In-Transit', 'Eagle1', '2025-05-18T19:11:30+08:00', '深圳市', '快件到达 【深圳黄田转运中心】', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "31", "remark": "快件到达 【深圳黄田转运中心】", "acceptTime": "2025-05-18 19:11:30", "acceptAddress": "深圳市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747608657-3001', 3001, 'Logistics In-Progress', 'Eagle1', '2025-05-19T06:50:57+08:00', '深圳市', '快件在【深圳黄田转运中心】完成分拣，准备发往 【深圳宝安大铲湾店】', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "30", "remark": "快件在【深圳黄田转运中心】完成分拣，准备发往 【深圳宝安大铲湾店】", "acceptTime": "2025-05-19 06:50:57", "acceptAddress": "深圳市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747608792-3004', 3004, 'Departed, In-Transit', 'Eagle1', '2025-05-19T06:53:12+08:00', '深圳市', '快件离开 【深圳黄田转运中心】，已在发往  【深圳宝安大铲湾店】 的路上', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "36", "remark": "快件离开 【深圳黄田转运中心】，已在发往  【深圳宝安大铲湾店】 的路上", "acceptTime": "2025-05-19 06:53:12", "acceptAddress": "深圳市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747610573-3002', 3002, 'Arrived, In-Transit', 'Eagle1', '2025-05-19T07:22:53+08:00', '深圳市', '快件到达 【深圳宝安大铲湾店，地址：宝安区大铲湾xxx】', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "31", "remark": "快件到达 【深圳宝安大铲湾店，地址：宝安区大铲湾港区】", "acceptTime": "2025-05-19 07:22:53", "acceptAddress": "深圳市", "firstStatusCode": "2", "firstStatusName": "运送中", "secondaryStatusCode": "201", "secondaryStatusName": "运送中"}'),
        ('ev_eg1-123412341234-1747610829-3450', 3450, 'Final Delivery In-Progress', 'Eagle1', '2025-05-19T07:27:09+08:00', '深圳市', '我们正在为您的快件分配最合适的快递员，请您稍等。', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "44", "remark": "我们正在为您的快件分配最合适的快递员，请您稍等。", "acceptTime": "2025-05-19 07:27:09", "acceptAddress": "深圳市", "firstStatusCode": "3", "firstStatusName": "派送中", "secondaryStatusCode": "301", "secondaryStatusName": "派送中"}'),
        ('ev_eg1-123412341234-1747613232-3450', 3450, 'Final Delivery In-Progress', 'Eagle1', '2025-05-19T08:07:12+08:00', '深圳市', '快件到达【深圳宝安商务大厦店】，快件交给【曾xx，联系电话：155555555】，正在派送途中）', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "204", "remark": "快件到达【深圳宝安大厦店】，快件交给【曾xx，联系电话：123412341】，正在派送途中", "acceptTime": "2025-05-19 08:07:12", "acceptAddress": "深圳市", "firstStatusCode": "3", "firstStatusName": "派送中", "secondaryStatusCode": "301", "secondaryStatusName": "派送中"}'),
        ('ev_eg1-123412341234-1747621417-3450', 3450, 'Final Delivery In-Progress', 'Eagle1', '2025-05-19T10:23:37+08:00', '深圳市', '快件交给【林xx，联系电话：1234123412】，正在派送途中', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "204", "remark": "快件交给【林xx，联系电话：1234123412】，正在派送途中（如有任何问题可先联系我，我将尽全力为您解决。", "acceptTime": "2025-05-19 10:23:37", "acceptAddress": "深圳市", "firstStatusCode": "3", "firstStatusName": "派送中", "secondaryStatusCode": "301", "secondaryStatusName": "派送中"}'),
        ('ev_eg1-123412341234-1747622441-3500', 3500, 'Delivered', 'Eagle1', '2025-05-19T10:40:41+08:00', '深圳市', '您的快件已派送成功（地下车库门口。），如有疑问请电联快递员【林xx，电话：1234123412】。', 'eg1', '123412341234', 'Eagle1', null, null, null, null, '{"updatedAt": "2025-07-25T04:11:54.425Z", "updateMethod": "manual-pull"}', '{"opCode": "80", "remark": "您的快件已派送成功（地下车库门口。），如有疑问请电联快递员。", "acceptTime": "2025-05-19 10:40:41", "acceptAddress": "深圳市", "firstStatusCode": "4", "firstStatusName": "已签收", "secondaryStatusCode": "401", "secondaryStatusName": "已签收"}');
